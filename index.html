<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Formulaire enquête incognito</title>
  <style>
    :root{
      --primary:#3498db;
      --primary-600:#2980b9;
      --success-bg:#d4edda;
      --success-tx:#155724;
      --success-bd:#c3e6cb;
      --error-bg:#f8d7da;
      --error-tx:#721c24;
      --error-bd:#f5c6cb;
      --card:#ffffff;
      --card-alt:#f8f9fa;
      --text:#2c3e50;
      --muted:#7f8c8d;
      --ring:rgba(52,152,219,.2);
      --bg-form:#eaf3fb;
    }
    *{box-sizing:border-box}
    body{margin:0;background:#f0f2f5;color:var(--text);line-height:1.6;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}
    .container{max-width:860px;margin:auto;padding:16px}
    header{background:var(--card);border-radius:14px;padding:18px 18px 14px 18px;box-shadow:0 4px 15px rgba(0,0,0,.07);border-left:6px solid var(--primary);margin-bottom:16px;text-align:center}
    h1{margin:0 0 6px;font-size:clamp(20px,4.5vw,28px);color:var(--text)}
    .description{margin:0;color:var(--muted);font-size:clamp(14px,3.6vw,16px)}

    form{background:var(--bg-form);border-radius:14px;padding:16px;box-shadow:0 4px 15px rgba(0,0,0,.06)}
    .form-section{margin:0 0 14px;padding:14px;border-radius:12px;background:var(--card-alt);border-left:5px solid var(--primary);text-align:center}
    .form-section h2{margin:0 0 10px;font-size:clamp(16px,4vw,20px);color:var(--text)}

    .form-group{
      margin-bottom:14px;
      text-align:center;
      background:#eef7ff;
      border-radius:10px;
      padding:14px;
      box-shadow:0 2px 6px rgba(0,0,0,0.08);
    }

    label{display:block;margin-bottom:6px;font-weight:600;color:var(--text)}
    .required::after{content:" *";color:#e74c3c}

    input[type="text"],input[type="datetime-local"],input[type="number"],textarea,select{
      width:90%;padding:13px 12px;font-size:16px;border:1px solid #ddd;border-radius:10px;background:#fff;transition:border .2s, box-shadow .2s;margin:auto;display:block
    }
    input:focus,textarea:focus,select:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px var(--ring)}
    textarea{min-height:110px;resize:vertical}

    .radio-group,.checkbox-group{display:flex;flex-wrap:wrap;gap:12px;justify-content:center}
    .radio-item,.checkbox-item{display:flex;align-items:center;gap:8px;padding:8px 10px;border:1px solid #e9ecef;border-radius:999px;background:#fff}
    .radio-item input,.checkbox-item input{width:auto;height:18px}

    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:640px){.row{grid-template-columns:1fr}}

    .btn-submit{width:100%;max-width:340px;margin:22px auto 6px;display:block;background:var(--primary);color:#fff;border:none;border-radius:12px;padding:14px 18px;font-size:18px;font-weight:700;cursor:pointer;transition:transform .18s, background .2s}
    .btn-submit:hover{background:var(--primary-600);transform:translateY(-1px)}
    .btn-submit:active{transform:translateY(0)}
    .btn-submit[disabled]{background:#95a5a6;cursor:not-allowed;transform:none}

    .message{display:none;margin:14px 0;padding:14px;border-radius:12px;text-align:center}
    .message.success{display:block;background:var(--success-bg);color:var(--success-tx);border:1px solid var(--success-bd)}
    .message.error{display:block;background:var(--error-bg);color:var(--error-tx);border:1px solid var(--error-bd)}

    .loading{display:inline-block;width:20px;height:20px;border:3px solid rgba(255,255,255,.35);border-radius:50%;border-top-color:#fff;animation:spin 1s linear infinite;margin-right:8px;vertical-align:middle}
    @keyframes spin{to{transform:rotate(360deg)}}

    @media (max-width:480px){
      .radio-item,.checkbox-item{padding:10px 12px}
      input[type="text"],input[type="datetime-local"],input[type="number"],textarea,select{padding:14px;border-radius:12px;width:95%}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Formulaire enquête incognito</h1>
      <p class="description">Grille d'enquête incognito (à remplir par les enquêteurs après chaque trajet)</p>
    </header>

    <div id="message" class="message" role="status" aria-live="polite"></div>

    <form id="enqueteForm" novalidate>
      <!-- SECTION: Informations générales -->
      <div class="form-section">
        <h2>Informations générales</h2>
        <div class="row">
          <div class="form-group">
            <label for="enqueteur" class="required">Identifiant enquêteur :</label>
            <input type="text" id="enqueteur" name="enqueteur" value="Fadel" required autocomplete="off" />
          </div>
          <div class="form-group">
            <label for="ville" class="required">المدينة / Ville :</label>
            <select id="ville" name="ville" required>
              <option value="">اختار...</option>
              <option>RABAT</option><option>SALE</option><option>TEMARA</option><option>MARRAKECH</option>
              <option>MEKNES</option><option>TANGER</option><option>NADOR</option><option>CASABLANCA</option>
              <option>AGADIR INNEZGANE</option><option>TIZNIT</option><option>LAAYOUNE</option><option>KHENIFRA</option><option>MIDELT</option>
            </select>
          </div>
        </div>
        <div class="row">
          <div class="form-group">
            <label for="dateHeure" class="required">Date et heure du trajet :</label>
            <input type="datetime-local" id="dateHeure" name="dateHeure" required />
          </div>
          <div class="form-group">
            <label for="typeService" class="required">شمن سيرفيس خديتي :</label>
            <select id="typeService" name="typeService" required>
              <option value="">Sélectionnez un type de service</option>
              <option value="Grand_Taxi">Grand Taxi</option>
              <option value="Petit_Taxi">Petit Taxi</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label for="lieux" class="required">منين بديتي وفين مشيتي :</label>
          <input type="text" id="lieux" name="lieux" placeholder="Ex: Gare Nord → Centre-ville" required inputmode="text" />
        </div>
      </div>

      <!-- SECTION: Évaluation du service -->
      <div class="form-section">
        <h2>Évaluation du service</h2>
        <div class="form-group">
          <label>الشيفور مزيان فلهدرة ؟</label>
          <div class="radio-group" role="radiogroup" aria-label="Courtoisie">
            <label class="radio-item"><input type="radio" id="courtoisOui" name="courtois" value="Oui" required /> Oui</label>
            <label class="radio-item"><input type="radio" id="courtoisNon" name="courtois" value="Non" /> Non</label>
          </div>
        </div>
        <div class="form-group">
          <label>الطاكسي/لكار نقي (ريحة، كوفيرت، كومفور) :</label>
          <div class="radio-group" role="radiogroup" aria-label="Présentation">
            <label class="radio-item"><input type="radio" id="presentationTresBon" name="presentation" value="Très bon" required /> Très bon</label>
            <label class="radio-item"><input type="radio" id="presentationMoyen" name="presentation" value="Moyen" /> Moyen</label>
            <label class="radio-item"><input type="radio" id="presentationMauvais" name="presentation" value="Mauvais" /> Mauvais</label>
          </div>
        </div>
        <div class="form-group">
          <label>السياقة :</label>
          <div class="radio-group" role="radiogroup" aria-label="Sécurité">
            <label class="radio-item"><input type="radio" id="securiteTresSecurisee" name="securite" value="Très sécurisée" required /> Très sécurisée</label>
            <label class="radio-item"><input type="radio" id="securiteMoyenne" name="securite" value="Moyenne" /> Moyenne</label>
            <label class="radio-item"><input type="radio" id="securiteRisquee" name="securite" value="Risquée" /> Risquée</label>
          </div>
        </div>
      </div>

      <!-- SECTION: Détails du trajet -->
      <div class="form-section">
        <h2>Détails du trajet</h2>
        <div class="row">
          <div class="form-group">
            <label for="tempsAttente" class="required">Temps d'attente avant départ :</label>
            <input type="number" id="tempsAttente" name="tempsAttente" min="0" placeholder="minutes" required />
          </div>
          <div class="form-group">
            <label>الثمن نورمال بحال لعاده ؟</label>
            <div class="radio-group" role="radiogroup" aria-label="Tarif conforme">
              <label class="radio-item"><input type="radio" id="tarifConformeOui" name="tarifConforme" value="Oui" required /> Oui</label>
              <label class="radio-item"><input type="radio" id="tarifConformeNon" name="tarifConforme" value="Non" /> Non</label>
            </div>
          </div>
        </div>
        <div class="form-group" id="descriptionNonConformeGroup" style="display:none;">
          <label for="descriptionNonConforme">علّاش ما كانش الثمن conforme؟</label>
          <textarea id="descriptionNonConforme" name="descriptionNonConforme" placeholder="مثلاً: زاد الثمن، تفاوض، ما دارش الكونتور..."></textarea>
        </div>
        <div class="form-group">
          <label for="dureeTrajet" class="required">Durée réelle du trajet :</label>
          <input type="number" id="dureeTrajet" name="dureeTrajet" min="0" placeholder="minutes" required />
        </div>
        <div class="form-group">
          <label for="observations">حوايج خايبين ولا ملاحظات (كتر من الناس، سرعة زايدة..):</label>
          <textarea id="observations" name="observations" placeholder="Décrivez ici tout élément notable..."></textarea>
        </div>
      </div>
      <button type="submit" class="btn-submit" id="submitBtn">
        <span id="submitText">Soumettre l'enquête</span>
      </button>
    </form>
  </div>
  <script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbxcOMpVMNDVWxTU5HFecxOocWKDqubNvI130k86v1eF2xgzfGpHYJG8Epgqr7WzwEkY/exec';
    (function initDate(){const el=document.getElementById('dateHeure');if(el)el.value=new Date().toISOString().slice(0,16);})();
    document.querySelectorAll('input[name="tarifConforme"]').forEach(r=>{r.addEventListener('change',function(){const g=document.getElementById('descriptionNonConformeGroup');const a=document.getElementById('descriptionNonConforme');if(this.value==='Non'){g.style.display='block';a.required=true;a.focus();}else{g.style.display='none';a.required=false;a.value='';}})});
    document.getElementById('enqueteForm').addEventListener('submit',async function(e){e.preventDefault();const s=document.getElementById('submitBtn');const t=document.getElementById('submitText');const m=document.getElementById('message');if(!this.checkValidity()){this.reportValidity();return;}s.disabled=true;t.innerHTML='<span class="loading"></span> Envoi en cours...';try{const formData=new FormData(this);const response=await fetch(scriptURL,{method:'POST',body:formData});const result=await response.json();if(result.result==='success'){m.textContent='Enquête soumise avec succès !';m.className='message success';m.style.display='block';this.reset();document.getElementById('descriptionNonConformeGroup').style.display='none';document.getElementById('dateHeure').value=new Date().toISOString().slice(0,16);window.scrollTo({top:0,behavior:'smooth'});}else{throw new Error(result.error||'Erreur inconnue');}}catch(err){m.textContent="Erreur lors de l'envoi : "+err.message;m.className='message error';m.style.display='block';}finally{s.disabled=false;t.textContent="Soumettre l'enquête";setTimeout(()=>{m.style.display='none';},5000);}});
  </script>
</body>
</html>
